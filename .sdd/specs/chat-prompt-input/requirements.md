# 要件定義書

## 機能概要
`chats/[chatId]` のプロンプト入力UIを改善し、送信時にユーザー発言カードとAI応答カードを連続的に表示しながら、分岐UIまで一連の表示を整える。

## ユーザーストーリー
- ユーザーとして、`chats/[chatId]` で入力した内容を送信すると、そのままユーザー発言カードとして確定し、続けてAI応答と次の入力が自然に現れてほしい。なぜなら、会話の流れを途切れさせずに分岐操作まで進めたいから。

## 機能要件
### 要件1：プロンプトカードのUI調整
- `chats/[chatId]` のプロンプトカードに `chats` 画面のプロンプトカードと同様の矢印マークを表示する。
- 入力文が複数行になる場合、内容の長さに応じてテキストボックスの高さを段階的に広げる（急激に拡大しない）。
- 受入基準：
  - [ ] プロンプトカードに矢印マークが表示されること
  - [ ] 入力が複数行になった際に、段階的に高さが増えること

### 要件2：送信後のカード切り替えと表示更新
- 送信された入力は、テキストボックスからユーザー発言バブルへ切り替えて表示する。
- ユーザー発言バブルから伸びる線を表示する。
- AIのレスポンスを表示する。
- 表示に用いるカードは新規作成ではなく再利用し、内容のみを更新して表示する。
- AIレスポンスから線を伸ばし、次のテキストボックスを表示する。
- 線の両隣に新しいブランチピルを表示する。
- 受入基準：
  - [ ] 送信後、入力欄がユーザー発言バブルに切り替わること
  - [ ] ユーザー発言バブルから線が表示されること
  - [ ] AIレスポンスが表示されること
  - [ ] 表示カードが再利用され、内容のみ更新されること
  - [ ] AIレスポンスから線と次のテキストボックスが表示されること
  - [ ] 線の両隣にブランチピルが表示されること

## 非機能要件
- パフォーマンス：入力に応じた高さ調整が行われても、UI操作が体感で遅延しないこと。
- セキュリティ：既存の認証・API仕様を変更しないこと。
