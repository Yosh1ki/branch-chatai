# テスト計画（Branch: MVP版）

本ドキュメントでは、Branch MVP におけるテスト範囲と確認項目を定義します。

---

## 1. ユニットテスト

-   ConversationHistoryBuilder の履歴結合（親チェーンのみ）
-   HistorySummarizer の 40 件超過分の要約置換
-   UsageLimiter の日次上限（Free 10 件）の判定
-   SafetyFilter の Fast Gate + 外部モデレーション判定

---

## 2. API / 統合テスト

-   `/api/chat` の統合テスト（正常系）
-   requestId 冪等性の確認
-   429（Free 上限超過）
-   400/409（ブランチ整合性欠損）

---

## 3. 受入チェック（ローカル環境）

-   分岐履歴の取得範囲が正しいこと
-   40 件超過時に要約へ置換されること
-   フォールバック/再試行が 1 回のみであること
-   危険入力が 400 で拒否されること
-   PII がログに残らないこと

---

## 4. 未完了・依存事項

-   ローカルでの受入確認には API キー/DB 環境が必要
-   E2E テストは MVP 後に拡張予定

---

以上。
