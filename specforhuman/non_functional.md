---
# 非機能要件仕様書（Branch: MVP版）

本ドキュメントでは、Branch プロダクトの MVP 段階における「非機能要件」を定義します。
主に性能、可用性、セキュリティ、スケーラビリティの観点で記載します。
---

## 🏎️ 1. パフォーマンス要件

| 項目                | 目標値                             | 備考                                   |
| ------------------- | ---------------------------------- | -------------------------------------- |
| チャット応答速度    | 3 秒以内（初回ストリーム開始まで） | モデルの応答開始を優先。完了は非同期可 |
| UI レンダリング速度 | 1 秒以内（メッセージ追加時）       | 新規メッセージ描画時の最大遅延         |
| API レスポンス速度  | 300ms 以内（DB アクセス含む）      | `/api/chat` および `/api/chats`        |

---

## 🔐 2. セキュリティ要件

-   認証は **Google OAuth + HTTPS** にて実施
-   Authorization ヘッダーにて Bearer Token を全 API に使用
-   全ての API エンドポイントは認証必須
-   チャットデータはユーザー単位で隔離（他ユーザーから参照不可）
-   logs / バグレポートには機密情報や PII を含めない

---

## 📈 3. スケーラビリティ要件

| 項目         | 要件／備考                                   |
| ------------ | -------------------------------------------- |
| サーバー構成 | Next.js + Vercel（Edge Runtime 対応）        |
| DB 構成      | Supabase または Railway 上の Postgres        |
| LLM 負荷     | 1 ユーザーあたり最大 10 リクエスト/日 (Free) |
| 今後の拡張性 | Stripe 連携、共有リンク、リッチメディアなど  |

---

## 🧯 4. 信頼性・可用性要件

-   サービス稼働時間：99%以上（大規模障害を除く）
-   データ保存：Postgres のバックアップを 24 時間ごとに取得
-   ドキュメントは GitHub リポジトリに保存・バージョン管理

---

## 📊 5. ログ・監視要件

-   API リクエストは Cloud Logging/Vercel Analytics で監視
-   エラーやレート制限は DB とコンソールに記録
-   モデル名/トークン量/エラーのみを記録し、PII は保存しない
-   UI コンソールでの送信失敗は、ユーザーに通知

---

## 🧪 6. テスト要件

| 項目           | 対応状況 | 備考                                           |
| -------------- | -------- | ---------------------------------------------- |
| ユニットテスト | △        | 履歴結合/要約/上限判定/安全判定を重点で追加     |
| API テスト     | △        | `/api/chat` の統合テストを優先                 |
| E2E テスト     | △        | Cypress + Next.js で送信フローを確認           |
| ロードテスト   | ×        | MVP 段階では未対応。ユーザー増加後に検討       |

---

以上。
